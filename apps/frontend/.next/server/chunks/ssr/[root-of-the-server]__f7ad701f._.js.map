{"version":3,"sources":["../../../../../../apps/frontend/src/lib/toast.ts","../../../../../../apps/frontend/src/app/discover/%5Bslug%5D/session/%5BsessionId%5D/page.tsx"],"sourcesContent":["/**\n * Toast notification utilities\n * Wrapper around react-hot-toast for consistent notifications\n */\n\nimport toast from 'react-hot-toast';\n\nexport const showToast = {\n    success: (message: string) => {\n        toast.success(message);\n    },\n\n    error: (message: string) => {\n        toast.error(message);\n    },\n\n    loading: (message: string) => {\n        return toast.loading(message);\n    },\n\n    promise: <T,>(\n        promise: Promise<T>,\n        messages: {\n            loading: string;\n            success: string;\n            error: string;\n        }\n    ) => {\n        return toast.promise(promise, messages);\n    },\n\n    dismiss: (toastId?: string) => {\n        toast.dismiss(toastId);\n    },\n};\n","/**\n * Flow Session Page\n * Interactive questionnaire for a discovery flow\n */\n\n'use client';\n\nimport { use, useState } from 'react';\nimport { useRouter } from 'next/navigation';\nimport { useFlowSession, useSubmitAnswer, useCompleteFlow } from '@/hooks';\nimport { showToast } from '@/lib/toast';\nimport Link from 'next/link';\nimport type { Question as QuestionType } from '@/types/flow';\n\nexport default function FlowSessionPage({ \n  params \n}: { \n  params: Promise<{ slug: string; sessionId: string }> \n}) {\n  const { slug, sessionId } = use(params);\n  const router = useRouter();\n  const [selectedValue, setSelectedValue] = useState<string | string[]>('');\n  \n  const { data: response, isLoading, error, refetch } = useFlowSession(sessionId);\n  const submitAnswerMutation = useSubmitAnswer();\n  const completeFlowMutation = useCompleteFlow();\n\n  const session = response?.data;\n\n  const handleOptionSelect = (value: string, isMultiple: boolean) => {\n    if (isMultiple) {\n      setSelectedValue(prev => {\n        const currentValues = Array.isArray(prev) ? prev : [];\n        if (currentValues.includes(value)) {\n          return currentValues.filter(v => v !== value);\n        }\n        return [...currentValues, value];\n      });\n    } else {\n      setSelectedValue(value);\n    }\n  };\n\n  const handleSubmitAnswer = async () => {\n    if (!session?.currentQuestion || !selectedValue || \n        (Array.isArray(selectedValue) && selectedValue.length === 0)) {\n      showToast.error('Please select an answer');\n      return;\n    }\n\n    try {\n      const result = await submitAnswerMutation.mutateAsync({\n        sessionId,\n        questionId: session.currentQuestion.id,\n        value: selectedValue,\n      });\n\n      if (result.data.status === 'completed') {\n        showToast.success('Flow completed!');\n        router.push(`/discover/${slug}/results/${sessionId}`);\n      } else {\n        // Clear selection for next question\n        setSelectedValue('');\n        // Refetch to get next question\n        await refetch();\n      }\n    } catch (err) {\n      showToast.error('Failed to submit answer');\n    }\n  };\n\n  const handleSkipToResults = async () => {\n    try {\n      await completeFlowMutation.mutateAsync(sessionId);\n      showToast.success('Flow completed!');\n      router.push(`/discover/${slug}/results/${sessionId}`);\n    } catch (err) {\n      showToast.error('Failed to complete flow');\n    }\n  };\n\n  if (isLoading) {\n    return (\n      <div className=\"min-h-screen flex items-center justify-center\">\n        <div className=\"text-center\">\n          <div className=\"inline-block animate-spin text-6xl mb-4\">âš¡</div>\n          <p className=\"text-xl text-[var(--muted)]\">Loading session...</p>\n        </div>\n      </div>\n    );\n  }\n\n  if (error || !session) {\n    return (\n      <div className=\"min-h-screen flex items-center justify-center\">\n        <div className=\"text-center\">\n          <div className=\"text-6xl mb-4\">ðŸ˜•</div>\n          <h1 className=\"text-3xl font-bold mb-4\">Session Not Found</h1>\n          <p className=\"text-[var(--muted)] mb-6\">\n            This session doesn't exist or has expired.\n          </p>\n          <Link\n            href=\"/discover\"\n            className=\"inline-block px-6 py-3 bg-[var(--foreground)] text-[var(--background)] rounded-full font-semibold hover:opacity-80 transition-opacity\"\n          >\n            Start New Discovery\n          </Link>\n        </div>\n      </div>\n    );\n  }\n\n  if (session.status === 'completed') {\n    return (\n      <div className=\"min-h-screen flex items-center justify-center\">\n        <div className=\"text-center\">\n          <div className=\"text-6xl mb-4\">âœ…</div>\n          <h1 className=\"text-3xl font-bold mb-4\">Flow Already Completed</h1>\n          <p className=\"text-[var(--muted)] mb-6\">\n            This flow has already been completed.\n          </p>\n          <Link\n            href={`/discover/${slug}/results/${sessionId}`}\n            className=\"inline-block px-6 py-3 bg-[var(--foreground)] text-[var(--background)] rounded-full font-semibold hover:opacity-80 transition-opacity\"\n          >\n            View Results\n          </Link>\n        </div>\n      </div>\n    );\n  }\n\n  const currentQuestion = session.currentQuestion;\n  if (!currentQuestion) {\n    return (\n      <div className=\"min-h-screen flex items-center justify-center\">\n        <div className=\"text-center\">\n          <div className=\"text-6xl mb-4\">ðŸŽ‰</div>\n          <h1 className=\"text-3xl font-bold mb-4\">All Questions Answered!</h1>\n          <p className=\"text-[var(--muted)] mb-6\">\n            Click below to see your recommendations.\n          </p>\n          <button\n            onClick={handleSkipToResults}\n            disabled={completeFlowMutation.isPending}\n            className=\"px-8 py-3 bg-[var(--foreground)] text-[var(--background)] rounded-full font-semibold hover:opacity-80 transition-opacity disabled:opacity-50\"\n          >\n            {completeFlowMutation.isPending ? 'Loading...' : 'Get Recommendations'}\n          </button>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen bg-[var(--background)]\">\n      {/* Progress Bar */}\n      <div className=\"fixed top-0 left-0 right-0 h-1 bg-[var(--surface)] z-50\">\n        <div \n          className=\"h-full bg-[var(--foreground)] transition-all duration-500\"\n          style={{ width: `${session.progress}%` }}\n        />\n      </div>\n\n      {/* Header */}\n      <div className=\"border-b border-[var(--border)] bg-[var(--surface)]\">\n        <div className=\"container mx-auto px-4 py-6\">\n          <div className=\"flex items-center justify-between\">\n            <div className=\"flex items-center gap-4\">\n              <span className=\"text-3xl\">{session.flow.icon}</span>\n              <div>\n                <h1 className=\"text-xl font-bold\">{session.flow.title}</h1>\n                <p className=\"text-sm text-[var(--muted)]\">\n                  Question {currentQuestion.questionNumber} of {currentQuestion.totalQuestions}\n                </p>\n              </div>\n            </div>\n            <button\n              onClick={handleSkipToResults}\n              className=\"text-sm text-[var(--muted)] hover:text-[var(--foreground)] transition-colors\"\n            >\n              Skip to Results â†’\n            </button>\n          </div>\n        </div>\n      </div>\n\n      {/* Question */}\n      <div className=\"container mx-auto px-4 py-12\">\n        <div className=\"max-w-2xl mx-auto\">\n          {/* Question Text */}\n          <h2 className=\"text-3xl md:text-4xl font-bold mb-8 text-center\">\n            {currentQuestion.text}\n          </h2>\n\n          {/* Options */}\n          {currentQuestion.options && (\n            <div className=\"space-y-3 mb-8\">\n              {currentQuestion.options.map((option) => {\n                const isSelected = currentQuestion.type === 'multiple'\n                  ? Array.isArray(selectedValue) && selectedValue.includes(option.value)\n                  : selectedValue === option.value;\n\n                return (\n                  <button\n                    key={option.value}\n                    onClick={() => handleOptionSelect(option.value, currentQuestion.type === 'multiple')}\n                    className={`w-full p-5 text-left border-2 rounded-xl transition-all ${\n                      isSelected\n                        ? 'border-[var(--foreground)] bg-[var(--surface)]'\n                        : 'border-[var(--border)] hover:border-[var(--foreground)]'\n                    }`}\n                  >\n                    <div className=\"flex items-center gap-4\">\n                      <div className={`w-6 h-6 rounded-${currentQuestion.type === 'multiple' ? 'md' : 'full'} border-2 flex items-center justify-center ${\n                        isSelected \n                          ? 'border-[var(--foreground)] bg-[var(--foreground)]' \n                          : 'border-[var(--border)]'\n                      }`}>\n                        {isSelected && (\n                          <span className=\"text-[var(--background)] text-sm\">âœ“</span>\n                        )}\n                      </div>\n                      <span className=\"text-lg\">{option.label}</span>\n                    </div>\n                  </button>\n                );\n              })}\n            </div>\n          )}\n\n          {/* Submit Button */}\n          <div className=\"text-center\">\n            <button\n              onClick={handleSubmitAnswer}\n              disabled={submitAnswerMutation.isPending || !selectedValue || \n                (Array.isArray(selectedValue) && selectedValue.length === 0)}\n              className=\"px-10 py-4 bg-[var(--foreground)] text-[var(--background)] rounded-full font-bold text-lg hover:opacity-80 transition-opacity disabled:opacity-50 disabled:cursor-not-allowed\"\n            >\n              {submitAnswerMutation.isPending ? 'Submitting...' : 'Continue'}\n            </button>\n          </div>\n\n          {/* Helper Text */}\n          {currentQuestion.type === 'multiple' && (\n            <p className=\"text-center text-sm text-[var(--muted)] mt-4\">\n              Select all that apply\n            </p>\n          )}\n        </div>\n      </div>\n    </div>\n  );\n}\n"],"names":[],"mappings":"6JAKA,IAAA,EAAA,EAAA,CAAA,CAAA,0BAEyB,CACrB,QAAS,AAAC,IACN,EAAA,OAAK,CAAC,OAAO,CAAC,EAClB,EAEA,MAAO,AAAC,IACJ,EAAA,OAAK,CAAC,KAAK,CAAC,EAChB,EAEA,QAAS,AAAC,GACC,EAAA,OAAK,CAAC,OAAO,CAAC,GAGzB,QAAS,CACL,EACA,IAMO,EAAA,OAAK,CAAC,OAAO,CAAC,EAAS,GAGlC,QAAU,AAAD,IACL,EAAA,OAAK,CAAC,OAAO,CAAC,EAClB,CACJ,4BC/BC,IAAA,EAAA,EAAA,CAAA,CAAA,OAID,EAAA,EAAA,CAAA,CAAA,OACA,EAAA,EAAA,CAAA,CAAA,OACA,EAAA,CAAA,CAAA,OAAA,IAAA,EAAA,EAAA,CAAA,CAAA,OACA,EAAA,EAAA,CAAA,CAAA,OACA,EAAA,EAAA,CAAA,CAAA,OAGe,SAAS,EAAgB,QACtC,CAAM,CAGP,EACC,GAAM,MAAE,CAAI,WAAE,CAAS,CAAE,CAAG,CAAA,EAAA,EAAA,GAAA,AAAG,EAAC,GAC1B,EAAS,CAAA,EAAA,EAAA,SAAA,AAAS,IAClB,CAAC,EAAe,EAAiB,CAAG,CAAA,EAAA,EAAA,QAAA,AAAQ,EAAoB,IAEhE,CAAE,KAAM,CAAQ,WAAE,CAAS,OAAE,CAAK,SAAE,CAAO,CAAE,CAAG,CAAA,EAAA,EAAA,cAAA,AAAc,EAAC,GAC/D,EAAuB,CAAA,EAAA,EAAA,eAAA,AAAe,IACtC,EAAuB,CAAA,EAAA,EAAA,eAAA,AAAe,IAEtC,EAAU,GAAU,KAgBpB,EAAqB,UACzB,GAAI,CAAC,GAAS,iBAAmB,CAAC,GAC7B,MAAM,OAAO,CAAC,IAA2C,IAAzB,EAAc,MAAM,CAAS,YAChE,EAAA,SAAS,CAAC,KAAK,CAAC,2BAIlB,GAAI,CACF,IAAM,EAAS,MAAM,EAAqB,WAAW,CAAC,WACpD,EACA,WAAY,EAAQ,eAAe,CAAC,EAAE,CACtC,MAAO,CACT,GAE2B,aAAa,CAApC,EAAO,IAAI,CAAC,MAAM,EACpB,EAAA,SAAS,CAAC,OAAO,CAAC,mBAClB,EAAO,IAAI,CAAC,CAAC,UAAU,EAAE,EAAK,SAAS,EAAE,EAAA,CAAW,IAGpD,EAAiB,IAEjB,MAAM,IAEV,CAAE,MAAO,EAAK,CACZ,EAAA,SAAS,CAAC,KAAK,CAAC,0BAClB,CACF,EAEM,EAAsB,UAC1B,GAAI,CACF,MAAM,EAAqB,WAAW,CAAC,GACvC,EAAA,SAAS,CAAC,OAAO,CAAC,mBAClB,EAAO,IAAI,CAAC,CAAC,UAAU,EAAE,EAAK,SAAS,EAAE,EAAA,CAAW,CACtD,CAAE,MAAO,EAAK,CACZ,EAAA,SAAS,CAAC,KAAK,CAAC,0BAClB,CACF,EAEA,GAAI,EACF,MACE,CAAA,EAFW,AAEX,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,yDACb,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,wBACb,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,mDAA0C,MACzD,CAAA,EAAA,EAAA,GAAA,EAAC,IAAA,CAAE,UAAU,uCAA8B,4BAMnD,GAAI,GAAS,CAAC,EACZ,MACE,CAFmB,AAEnB,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,yDACb,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,wBACb,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,yBAAgB,OAC/B,CAAA,EAAA,EAAA,GAAA,EAAC,KAAA,CAAG,UAAU,mCAA0B,sBACxC,CAAA,EAAA,EAAA,GAAA,EAAC,IAAA,CAAE,UAAU,oCAA2B,+CAGxC,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,OAAI,CAAA,CACH,KAAK,YACL,UAAU,iJACX,6BAQT,GAAuB,aAAa,CAAhC,EAAQ,MAAM,CAChB,MACE,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,yDACb,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,wBACb,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,yBAAgB,MAC/B,CAAA,EAAA,EAAA,GAAA,EAAC,KAAA,CAAG,UAAU,mCAA0B,2BACxC,CAAA,EAAA,EAAA,GAAA,EAAC,IAAA,CAAE,UAAU,oCAA2B,0CAGxC,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,OAAI,CAAA,CACH,KAAM,CAAC,UAAU,EAAE,EAAK,SAAS,EAAE,EAAA,CAAW,CAC9C,UAAU,iJACX,sBAQT,IAAM,EAAkB,EAAQ,eAAe,QAC1C,AAAL,EAsBE,CAAA,CAtBE,CAsBF,EAAA,IAAA,EAAC,IAtBmB,EAsBnB,CAAI,UAAU,gDAEb,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,mEACb,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CACC,UAAU,4DACV,MAAO,CAAE,MAAO,CAAA,EAAG,EAAQ,QAAQ,CAAC,CAAC,CAAC,AAAC,MAK3C,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,+DACb,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,uCACb,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,8CACb,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,oCACb,CAAA,EAAA,EAAA,GAAA,EAAC,OAAA,CAAK,UAAU,oBAAY,EAAQ,IAAI,CAAC,IAAI,GAC7C,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,WACC,CAAA,EAAA,EAAA,GAAA,EAAC,KAAA,CAAG,UAAU,6BAAqB,EAAQ,IAAI,CAAC,KAAK,GACrD,CAAA,EAAA,EAAA,IAAA,EAAC,IAAA,CAAE,UAAU,wCAA8B,YAC/B,EAAgB,cAAc,CAAC,OAAK,EAAgB,cAAc,UAIlF,CAAA,EAAA,EAAA,GAAA,EAAC,SAAA,CACC,QAAS,EACT,UAAU,wFACX,6BAQP,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,wCACb,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,8BAEb,CAAA,EAAA,EAAA,GAAA,EAAC,KAAA,CAAG,UAAU,2DACX,EAAgB,IAAI,GAItB,EAAgB,OAAO,EACtB,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,0BACZ,EAAgB,OAAO,CAAC,GAAG,CAAC,AAAC,IAC5B,IAAM,EAAsC,aAAzB,EAAgB,IAAI,CACnC,MAAM,OAAO,CAAC,IAAkB,EAAc,QAAQ,CAAC,EAAO,KAAK,EACnE,IAAkB,EAAO,KAAK,CAElC,MACE,CAAA,EAAA,EAAA,GAAA,EAAC,SAAA,CAEC,QAAS,IAAM,cAjLL,EAiLwB,EAAO,GAjLhB,EAiLqB,MAA2B,aAAzB,EAAgB,IAAI,CA/KlF,EAAiB,IACf,IAAM,EAAgB,MAAM,OAAO,CAAC,GAAQ,EAAO,EAAE,QACrD,AAAI,EAAc,QAAQ,CAAC,GAClB,EAAc,GADY,GACN,CAAC,GAAK,IAAM,GAElC,IAAI,EAAe,EAC5B,AADkC,GAGlC,EAAiB,KAwKH,UAAW,CAAC,wDAAwD,EAClE,EACI,iDACA,0DAAA,CACJ,UAEF,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,oCACb,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAW,CAAC,gBAAgB,EAA2B,aAAzB,EAAgB,IAAI,CAAkB,KAAO,OAAO,2CAA2C,EAChI,EACI,oDACA,yBAAA,CACJ,UACC,GACC,CAAA,EAAA,EAAA,GAAA,EAAC,OAAA,CAAK,UAAU,4CAAmC,QAGvD,CAAA,EAAA,EAAA,GAAA,EAAC,OAAA,CAAK,UAAU,mBAAW,EAAO,KAAK,OAlBpC,EAAO,KAAK,CAsBvB,KAKJ,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,uBACb,CAAA,EAAA,EAAA,GAAA,EAAC,SAAA,CACC,QAAS,EACT,SAAU,EAAqB,SAAS,EAAI,CAAC,GAC1C,MAAM,OAAO,CAAC,IAA2C,IAAzB,EAAc,MAAM,CACvD,UAAU,yLAET,EAAqB,SAAS,CAAG,gBAAkB,eAK9B,aAAzB,EAAgB,IAAI,EACnB,CAAA,EAAA,EAAA,GAAA,EAAC,IAAA,CAAE,UAAU,wDAA+C,kCA9GlE,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,yDACb,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,wBACb,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,yBAAgB,OAC/B,CAAA,EAAA,EAAA,GAAA,EAAC,KAAA,CAAG,UAAU,mCAA0B,4BACxC,CAAA,EAAA,EAAA,GAAA,EAAC,IAAA,CAAE,UAAU,oCAA2B,6CAGxC,CAAA,EAAA,EAAA,GAAA,EAAC,SAAA,CACC,QAAS,EACT,SAAU,EAAqB,SAAS,CACxC,UAAU,wJAET,EAAqB,SAAS,CAAG,aAAe,4BA0G7D"}